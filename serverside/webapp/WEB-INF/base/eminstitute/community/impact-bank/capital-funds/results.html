#set( $searcher = $mediaarchive.getSearcher("librarycollection") )
#set( $projects = $mediaarchive.query("librarycollection").orgroup("communitytag", "ibcapitalfund").sort("name").cachedSearch() )

#set( $tags = $projects.collectValues("communitytag") )
  
		<div id="filterControls" class="text-center mb-5 mb-md-7">
			<a class="cbp-filter-item cbp-filter-item-active btn btn-xs btn-soft-secondary btn-pill py-2 px-3 m-1" href="javascript:;" data-filter="*">All</a>

      #foreach($tag in $tags)
        <a class="cbp-filter-item btn btn-xs btn-soft-secondary btn-pill py-2 px-3 m-1" href="javascript:;" data-filter=".$!{tag}">
          #set( $data = $mediaarchive.getCachedData("communitytag",$tag) )
          #text( $data)          
          </a>
      #end 
		</div>


<div class="container px-3">
  <div class="cbp"
    data-filters="#filterControls"
    data-hs-cbp-options='{
      "animationType": "quicksand",
      "caption": "zoom",
      "gapHorizontal": 10,
      "gapVertical": 10,
      "mediaQueries": [
        {"width": 1500, "cols": 2},
        {"width": 800, "cols": 2},
        {"width": 480, "cols": 1}
      ]
    }'>
    #foreach($project in $projects)
      #set($link = "${communitylink}/${project.urlname}")
      #set($logo = false)
      #if($project.assetportrait)
        #set($asset = $mediaarchive.getAsset($project.assetportrait))
        #set($logo = $mediaarchive.asLinkToPreview($asset, "image200x200.webp"))
      #else
        #set($logo = "${communityhome}/assets/dp.png")
      #end

      #set($description = $project.get("collectivedescription"))
      #ifnull($description)
        #set($description = $project.get("longcaption"))
      #end
  
      #if($project.collectivebanner)
        #set( $banner = $mediaarchive.getAsset($project.collectivebanner) )
        #set ($bannerurl = "/$mediaarchive.getMediaDbId()/services/module/asset/downloads/preset/$!{banner.sourcepath}/image1920x500cropped.webp")
      #else
        #set ($bannerurl = false)
      #end

      #set( $tags = $project.getValues("communitytag") )

      <div class="cbp-item rounded #foreach($tag in $tags) $!{tag} #end"">
        <div class="m-4 text-center rounded h-100 shadow project-container">
          <div
            #if($bannerurl)
              class="project-cover"
              style="background-image: url('$bannerurl')" 
            #else
              class="project-cover bg-dark"
            #end>
            <a href="$link" class="project-thumb-link">
              <img src="$logo" />
            </a> 
          </div>
          <div class="d-flex flex-column align-items-center">
            <a href="$link">
              <h2 class="h3 mb-0">#text($project)</h2>
            </a>
           
            #set($owner = $mediaarchive.getUser($project.owner))
            <small class="creator">by #text($owner)</small>
          </div>

          <p class="my-3 px-3">
            #if($description.length() > 300)
              $!{description.substring(0,300)}...
            #else 
              $!{description}
            #end
          </p>
            <div >

              #foreach($tag in $tags)             
              <span class="badge badge-pill badge-secondary my-1">
              #text( $mediaarchive.getCachedData("communitytag",$tag) ) 
              </span>
              #end
            </div>

          <div class="gap-2 icons d-flex flex-row justify-content-center align-items-center">
            #ifnotnull($project.facebooklink)
              <a href="$librarycol.facebooklink" class="text-dark py-2">
                <span><i class="fab fa-facebook-f"></i></span>
              </a>
            #end
            #ifnotnull($project.twitterlink)
              <a href="$librarycol.twitterlink" class="text-dark py-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-twitter-x"
                  viewBox="0 0 16 16">
                  <path
                    d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z" />
                </svg>
              </a>
            #end
            #ifnotnull($project.instagramlink)
              <a href="$librarycol.instagramlink" class="text-dark py-2">
                <span><i class="fab fa-instagram"></i></span>
              </a>
            #end
            #ifnotnull($project.linkedinlink)
              <a href="$librarycol.linkedinlink" class="text-dark py-2">
                <span><i class="fab fa-linkedin"></i></span>
              </a>
            #end
            #ifnotnull($project.githublink)
              <a href="$librarycol.githublink" class="text-dark py-2">
                <span><i class="fab fa-github"></i></span>
              </a>
            #end 
          </div>

          <div class="project-explore pb-3 mt-auto transition-3d-hover">
            <a href="$link" class="explore d-flex themed-btn py-2 rounded">
              Explore 
            </a>
          </div>

        </div>
      </div>
    #end
  </div>
</div> 