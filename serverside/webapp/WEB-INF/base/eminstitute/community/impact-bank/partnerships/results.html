#set( $searcher = $mediaarchive.getSearcher("librarycollection") )
#set( $projects = $mediaarchive.query("librarycollection").exact("communitytagcategory",$communitytagcategory.id).exact("communitytag","ibstartup").sort("name").cachedSearch() )


  #set( $tags = $projects.collectValues("communitytag") )

<div id="filterControls" class="text-center mb-5 mb-md-7">
  <a class="cbp-filter-item cbp-filter-item-active btn btn-xs btn-soft-secondary btn-pill py-2 px-3 m-1" href="javascript:;" data-filter="*">All</a>

  #foreach($tag in $tags)
    <a class="cbp-filter-item btn btn-xs btn-soft-secondary btn-pill py-2 px-3 m-1" href="javascript:;" data-filter=".$!{tag}">
      #set( $data = $mediaarchive.getCachedData("communitytag",$tag) )
      #text( $data)          
    </a>
  #end 
</div>
		
<div class="cbp"
  data-filters="#filterControls"
  data-hs-cbp-options='{
    "animationType": "quicksand",
    "caption": "zoom",
    "gapHorizontal": 10,
    "gapVertical": 10,
    "mediaQueries": [
      {"width": 1500, "cols": 4},
      {"width": 1100, "cols": 3},
      {"width": 800, "cols": 2},
      {"width": 480, "cols": 1}
    ]
  }'>

  #foreach($project in $projects)
    #set($link = "${communitylink}/${project.urlname}")
    #set($logo = false)
    #if($project.assetportrait)
      #set($asset = $mediaarchive.getAsset($project.assetportrait))
      #set($logo = $mediaarchive.asLinkToPreview($asset, "image200x200"))
    #else
      #set($logo = "${communityhome}/assets/logo.png")
    #end
    #set($description = $project.get("collectivedescription"))

    #if ($project.collectivebanner)
      #set( $banner= $mediaarchive.getAsset($project.collectivebanner) )
      #set ($bannerurl = "/$mediaarchive.getMediaDbId()/services/module/asset/downloads/preset/$!{banner.sourcepath}/image1920x500cropped.jpg")
    #end

    #set( $tags = $project.getValues("communitytag") )
    
    <div class="cbp-item #foreach($tag in $tags) $!{tag} #end">
      <a class="cbp-caption project-container p-3" href="$link">
        <div class="d-flex flex-column align-items-center shadow rounded transition-3d-hover">
          <img class="img-fluid p-3" src="$logo" alt="Image Description">
          <div class="cbp-caption">
            <div class="px-2 pb-3">
              <h3 class="text-center h3 mb-0">#text($project)</h3>
              <p class="my-3 px-3 text-muted text-center">
                #if($description.length() > 300)
                  $!{description.substring(0,300)}...
                #else 
                  $!{description}
                #end
                Ready to turn your audience, platform, or idea into a profitable service? Partner with us to access powerful tools, earn commission, and deliver real valueâ€”without worrying about the tech.
              </p>
              <div class="d-flex justify-content-center flex-wrap px-3">
                #foreach($tag in $tags)             
                  <span class="badge badge-pill badge-primary m-1">
                  #text( $mediaarchive.getCachedData("communitytag",$tag) ) 
                  </span>
                #end
              </div>
            </div>
          </div>
        </div>
      </a>
    </div>
  #end
</div>
