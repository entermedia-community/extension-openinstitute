#if(!$project)
	#set( $project = $mediaarchive.getData("librarycollection",$upload.librarycollection) )
  ##$context.putPageValue("librarycol",$project)
#end

#set( $community = $mediaarchive.getCachedData("communitytagcategory", $project.communitytagcategory))

#if($project.urlname)
	#set($projectlink = "$!{community.externaldomain}/${project.urlname}")
#else
	#set($projectlink = "${communitylink}/#dash($project.getName())")
#end

#if($upload.urlname)
  #set($bloglink = "${communitylink}/${project.urlname}/blog/${upload.urlname}")
#else
  #set($bloglink = "${communitylink}/${project.urlname}/blog/${upload.id}")
#end

<article class="article-card">
  <div class="article-thumbnail-wrap">
    <a href="${bloglink}">
      <img loading="lazy" src="https://placehold.co/600x400" >
    </a>
  </div>
  <div class="article-article">
    <div class="d-flex align-items-center justify-content-between">
      <a href="${projectlink}" class="blog-community-name">
        #text($project)
      </a>
      <a class="emdialog text-muted small mx-2" data-width="900" data-hidefooter="true" data-librarycol="${project.getId()}" data-uploadid="${upload.id}" href="$communityhome/project/channel/share.html?collectionid=${project.getId()}&showupload=$upload.id">
        <i class="fas fa-share-alt"></i>
      </a>
    </div>
    #if($upload.title)
      <h2>
        <a href="${bloglink}">$upload.title</a>
      </h2>
    #end

    <div class="article-content">
      <div class="blog-item-body">
        #if($upload.longdescription)
          $url_util.xmlFirstParagraph($!upload.longdescription)
        #end
      </div>
    </div>

    <div class="d-flex align-items-center justify-content-between mt-auto">
      <div class="author-row">
        #set( $postuser = $userManager.getUser($upload.owner, true))
        $context.putPageValue("chatuser",$postuser)
        $pages.include("${communityhome}/users/icon.html",$context)
        <div class="d-flex align-items-center">
          <a class="author-name" href='#urlescape("${communityhome}/users/index.html?id=${postuser.getId()}")'>$postuser.getAnonNickName()</a>
          <span class="mx-2">â€¢</span>
          <time datetime='$upload.getDate("entity_date")' class="text-muted">
            #set($timestamp = $context.getAge($upload.getDate("entity_date")))
            #ifnull($timestamp)
            [[Today]]
            #end
            #ifnotnull($timestamp)
            [[Posted on]] $timestamp [[ago]]
            #end
          </time>
        </div>
      </div>
      <div class="d-flex align-items-center">
        <a href="${bloglink}" class="text-muted small mx-2">
          <strong>5</strong> <i class="fas fa-heart"></i>
        </a>
        <a href="${bloglink}" class="text-muted small mx-2">
          <strong>3</strong> <i class="fas fa-comment"></i>
        </a>
      </div>
    </div>
  </div>
</article>