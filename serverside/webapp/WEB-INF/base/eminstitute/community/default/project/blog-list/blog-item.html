#if(!$librarycol)
  #set( $librarycol = $mediaarchive.getData("librarycollection",$userpost.librarycollection) )
#end

#set( $community = $mediaarchive.getCachedData("communitytagcategory", $librarycol.communitytagcategory))

#if($librarycol.urlname)
	#set($projectlink = "$!{community.externaldomain}/${librarycol.urlname}")
#else
	#set($projectlink = "${communitylink}/#dash($librarycol.getName())")
#end

#if($userpost.urlname)
  #set($bloglink = "${projectlink}/blog/${userpost.urlname}")
#else
  #set($bloglink = "${projectlink}/blog/${userpost.id}")
#end

<article class="article-card">
	
  #set($postasset = $mediaarchive.getAsset($userpost.primarymedia))
  #set($postimagesrc = $mediaarchive.asLinkToGenerated($postasset, "image550x350.jpg"))
	
  <div class="article-thumbnail-wrap">
    <a href="${bloglink}">
		#if($postimagesrc)
      <img loading="lazy" src="${postimagesrc}" >
	  #end
    </a>
  </div>
  <div class="article-article">
    <div class="d-flex align-items-center justify-content-between">
      ##<a href="${projectlink}" class="blog-community-name">
      ##  #text($librarycol)
      ##</a>
	  <div>
	  #if($caneditcollection && $userpost.poststatus != "published")
	  		<div class="badge text-bg-warning mb-2">[[Status]]: $userpost.poststatus</div>
			<a class="btn btn-xs btn-primary emdialog" data-width="900" 
												data-hidefooter="true"
												data-collectionid="${librarycol.getId()}" 
												data-id="${userpost.id}"
												href="$projectlink/channel/edit.html">
												<i class="fas fa-edit me-2"></i> [[Edit]]
											</a>
	  #end
	  </div>
      <a class="emdialog text-muted small ml-auto" data-width="900" data-hidefooter="true" data-librarycol="${librarycol.getId()}" data-uploadid="${upload.id}" href="$communityhome/project/channel/share.html?collectionid=${librarycol.getId()}&showupload=$userpost.id">
        <i class="fas fa-share-alt"></i>
      </a>
    </div>
	
	
	
    #ifnotnull($userpost.name)
      <h2>
        <a href="${bloglink}">$userpost.name</a>
      </h2>
    #end

    <div class="article-content">
      <div class="blog-item-body">
        #ifnotnull($userpost.maincontent)
          $url_util.xmlFirstParagraph($userpost.maincontent)
        #end
      </div>
    </div>

    <div class="d-flex align-items-center justify-content-between mt-auto">
      <div class="author-row">
        #set( $postuser = $userManager.getUser($userpost.owner, true))
        $context.putPageValue("chatuser",$postuser)
        $pages.include("${communityhome}/users/icon.html",$context)
        <div class="d-flex align-items-center">
          <a class="author-name" href='#urlescape("${communityhome}/users/index.html?id=${postuser.getId()}")'>$postuser.getAnonNickName()</a>
          <span class="mx-2">â€¢</span>
          <time datetime='$userpost.getDate("entity_date")' class="text-muted">
            #set($timestamp = $context.getAge($userpost.getDate("entity_date")))
            #ifnull($timestamp)
            [[Today]]
            #end
            #ifnotnull($timestamp)
            [[Posted on]] $timestamp [[ago]]
            #end
          </time>
        </div>
      </div>
      <div class="d-flex align-items-center">
		$context.putPageValue("userpostid", $userpost.getId())
		$pages.include("${communityhome}/project/blog/likecount.html?userpostid=$userpost.getId()", $context)
       #*
		 <a href="${bloglink}" class="text-muted small mx-2">
          <strong>3</strong> <i class="fas fa-comment"></i>
        </a>
		*#
      </div>
    </div>
  </div>
</article>