#if(!$librarycol)
	#set( $librarycol = $mediaarchive.getData("librarycollection",$userpost.librarycollection) )
	$context.putPageValue("librarycol",$librarycol)
#end

#set( $community = $mediaarchive.getCachedData("communitytagcategory",$librarycol.communitytagcategory))

#if($librarycol.urlname)
	#set($projectlink = "$!{community.externaldomain}/${librarycol.urlname}")
#else
	#set($projectlink = "${communitylink}/#dash($librarycol.getName())")
#end

#if($userpost.urlname)
  #set($bloglink = "${projectlink}/blog/${userpost.urlname}")
#else
  #set($bloglink = "${projectlink}/blog/${userpost.id}")
#end

#set($postasset = $mediaarchive.getAsset($userpost.primarymedia))
#set($postimagesrc = $mediaarchive.asLinkToGenerated($postasset, "image730x480cropped.jpg"))

<div id="$!{postasset.id}" 
	class='blog-post #if($postasset && $postasset.previewstatus!="2") ajaxstatus #end' 
	data-reloadspeed="2000"
	data-oemaxlevel="2"
	ajaxpath="$bloglink" >
	<div class="blog-list-item">
		<div class="w-100 d-flex align-items-center justify-content-between mb-3">
			<div class="blog-credit">
				<div class="blog-avatar">
					#set( $postuser = $userManager.getUser($userpost.owner, true))
					$context.putPageValue("chatuser",$postuser)
					$pages.include("${communityhome}/users/icon.html",$context)
				</div>
				<a class="text-brand"
					href='#urlescape("${communityhome}/users/index.html?id=${postuser.getId()}")'>
					$postuser.getAnonNickName()
				</a>
				<span class="d-inline-block mx-2">
					&middot;
				</span>
				<small class="text-muted fw-normal">
					#set($timestamp = $context.getAge($userpost.getDate("entity_date")))
					#ifnull($timestamp)
					[[Today]]
					#end
					#ifnotnull($timestamp)
					$timestamp [[ago]]
					#end
				</small>
			</div>
			#if($librarycol.collectionimage)
				#set($asset = $mediaarchive.getAsset($librarycol.collectionimage))
				#set( $projectlogo = $mediaarchive.asLinkToPreview($asset,"image200x200.jpg"))
			#else
				#set($projectlogo = "$communityhome/theme/images/OI_flower.png")
			#end
			
			<div class="blog-community">
				<a href="${projectlink}">
					<img src="$projectlogo" class="blog-community-img" alt="#text($librarycol)" />
				</a>
				<a href="${projectlink}" class="blog-community-name mb-0">
					#text($librarycol)
				</a>
				#if($user)
				<div class="dropdown">
					<button class="icon text-brand ms-1" data-bs-toggle="dropdown">
						<i class="fas fa-ellipsis-h"></i>
					</button>
					<ul class="dropdown-menu bg-white">
						<li>
							<a class="dropdown-item emdialog" data-width="900" data-hidefooter="true"
								data-librarycol="${librarycol.getId()}" data-uploadid="${userpost.id}"
								href="$projectlink/channel/share.html?collectionid=${librarycol.getId()}&showupload=$userpost.id">
								<i class="fas fa-share-alt me-2"></i> [[Share]]
							</a>
						</li>
						
						<li>
							<a class="dropdown-item emdialog" data-width="900" data-hidefooter="true"
								data-collectionid="${librarycol.getId()}" data-uploadid="${userpost.id}"
								href="$projectlink/channel/report/index.html?uploadid=${userpost.id}">
								<i class="far fa-flag me-2"></i> [[Report]]
							</a>
						</li>
						#if($caneditcollection)
							<li>
								<a class="dropdown-item emdialog" data-width="900" 
									data-hidefooter="true"
									data-collectionid="${librarycol.getId()}" 
									data-id="${userpost.id}"
									href="$projectlink/channel/edit.html">
									<i class="fas fa-edit me-2"></i> [[Edit]]
								</a>
							</li>
						#end
					</ul>
				</div>
				#end
			</div>
		</div>
		
		#if($caneditcollection && $userpost.poststatus != "published")
			  		<div class="badge text-bg-warning mb-2">[[Status]]: $userpost.poststatus</div>
		#end

		<div class="blog-container">
			#if($userpost.name)
				<h1 class="blog-title">
					#esc($!userpost.name)
					#if($userpost.getBoolean("exclusivecontent"))
						<i class="fas fa-lock"></i>
					#end
				</h1>
			#end
			
			
			

			#ifnotnull($postimagesrc)
			<div class="mb-4">
				<img loading="lazy" src="${postimagesrc}" >
								
			</div>
			#end
			
			<div class="blog-body">$!userpost.maincontent</div>
			
			<div class="blog-media" data-uploadid="${userpost.id}">
				$context.putPageValue("upload",$userpost)
				$pages.include("${communityhome}/project/channel/images.html", $context)
			</div>
	
			#if(!$userpost.name)
				<div>
					$pages.include("${communityhome}/project/blog/showpostmetadata.html",$context)
				</div>
			#end
	
			<div class="blog-tags">
				#set( $tags = $userpost.getValues("usertags") )
				#if($tags && !$tags.isEmpty() )
					#foreach( $tag in $tags )
						<a href="#" class="blog-tag" title="#esc($tag)">
							#esc($tag)
						</a>
					#end
				#end
			</div>
	
			<div class="blog-footer">
				$context.putPageValue("userpostid", $userpost.getId())
				$pages.include("./likeshow.html?userpostid=$userpost.getId()", $context)
				
				#*
				<button class="icon" data-bs-toggle="collapse" data-bs-target="#blog${userpost.id}">
					<i class="far fa-comment"></i>
					<span>[[Comment]]</span>
				</button>
				*#
				<a class="icon emdialog" data-width="900" data-hidefooter="true" data-librarycol="${librarycol.getId()}" data-uploadid="${userpost.id}" href="$communityhome/project/channel/share.html?collectionid=${librarycol.getId()}&showupload=$userpost.id">
					<i class="fas fa-share-alt"></i>
					<span>[[Share]]</span>
				</a>
			</div>
		</div>
	</div>

	<div class="collapse" id="blog${userpost.id}">
		$pages.include("${communityhome}/project/channel/comments/comments.html",$context)
	</div>

</div>