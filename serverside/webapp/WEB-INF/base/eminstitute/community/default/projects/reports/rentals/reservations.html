#set( $collectionid = ${librarycol.id})
<div id="rentalsreservations">
	<div class=" w-100 mb-3">

	  <h2 class="text-center m-0 flex-1">
	    [[Reservations]]
	  </h2>
	</div>
	<hr />

	#if ($!context.getRequestParameter("year")) 
		#set( $year = $!context.getRequestParameter("year"))
	#else
		#set( $year = $mediaarchive.getCurrentYear())
	#end
	
	#if ($!context.getRequestParameter("month"))
		#set( $month = $!context.getRequestParameter("month"))
	#else
		#set( $month = 0)
	#end
	
	
	
	<div class="card mb-4">
		<div class="card-header ">
			<b>[[Filters]]</b>	   		
	   	</div>
	  <div class="card-body">
		<form class="ajaxform row g-3 " 
			action="$!{projectlink}/store/reservations.html"
			data-targetdiv="rentalsreservations">
			<input type="hidden" name="oemaxlevel" value="1" />
	
			<div class="col-auto">
	   		<label>[[Year]]</label>
	   		<select class="form-control form-control-sm" name="year">
			#foreach($i in [2021..2030])
			   <option value="$i" #if($i == $year) selected="selected" #end>$i</option>
			#end
	   		</select>
	   		</div>
	   		<div class="col-auto">
	   		<label>[[Month]]</label>
	   		<select class="form-control form-control-sm" name="month">
	   		   <option value="0" #if($month == 0) selected="selected" #end>All</option>							
			   <option value="1" #if($month == 1) selected="selected" #end>[[January]]</option>
			   <option value="2" #if($month == 2) selected="selected" #end>[[February]]</option>
			   <option value="3" #if($month == 3) selected="selected" #end>[[March]]</option>
			   <option value="4" #if($month == 4) selected="selected" #end>[[April]]</option>
			   <option value="5" #if($month == 5) selected="selected" #end>[[May]]</option>
			   <option value="6" #if($month == 6) selected="selected" #end>[[June]]</option>
			   <option value="7" #if($month == 7) selected="selected" #end>[[July]]</option>
			   <option value="8" #if($month == 8) selected="selected" #end>[[August]]</option>
			   <option value="9" #if($month == 9) selected="selected" #end>[[September]]</option>
			   <option value="10" #if($month == 10) selected="selected" #end>[[October]]</option>
			   <option value="11" #if($month == 11) selected="selected" #end>[[November]]</option>
			   <option value="12" #if($month == 12) selected="selected" #end>[[December]]</option>							
	   		</select>
	   		</div>
	   		#*<div class="col-auto">
	   		<label>[[Status]]</label>
	   		<select class="form-control form-control-sm" name="status">
			   <option value="paid" #if($status == "paid") selected="selected" #end>[[Paid]]</option>
			   <option value="invoiced" #if($status == "invoiced") selected="selected" #end>[[Invoiced]]</option>
	   		</select>
	   		</div>
			*#
	   		<div class="col-auto align-self-end">
	   		<button class="btn btn-primary" type="submit">[[Search]]</button>
	   		</div>
			
		</form>
		</div>
	
	  #*<div class="d-flex align-items-center">
	    <input type="text" class="form-control" placeholder="Search reservations" style="min-width: 200px;" />
	    <select class="form-select ms-2">
	      <option value="1">Sort by</option>
	      <option value="2">Start Date</option>
	      <option value="3">End Date</option>
	      <option value="4">Guests</option>
	      <option value="5">Total Price</option>
	      <option value="6">Status</option>
	    </select>
	  </div>*#
	</div>
	
	<table class="table table-striped">
	  <thead>
	    <tr>
		  <th>[[Project]]</th>
	      <th>[[Rental]]</th>
	      <th>[[Dates]]</th>
		  <th>[[Guest]]</th>
		  <th>[[Pax]]</th>
		  <th>[[Status]]</th>
		  <th>[[Actions]]</th>
	    </tr>
	  </thead>
	  <tbody>
		#foreach($rental in $rentals)
			#set( $project = $mediaarchive.getCachedData("librarycollection",$rental.collectionid) )
			#set( $projectcommunity = $mediaarchive.getCachedData("communitytagcategory",$project.communitytagcategory))
			#if( $project ) 
				#set($hitprojectlink = "$!{projectcommunity.externaldomain}/${project.urlname}/store")
			#end
			<tr>
				<td>
                    
                        <a href="$!hitprojectlink">
                            #text($project)
                        </a>
                    
				</td>
					
				<td>
					#set($products = $rental.getValue("productlist"))
					
					#foreach ($prod    in $products) 
	                #set( $product = $mediaarchive.getCachedData("collectiveproduct",$prod.productid) )
	                #if( $product ) 
					#set($hitprojectlink = "$!{projectcommunity.externaldomain}/${project.urlname}/rentaldetails/${product.urlname}")
	                    <a href="$!hitprojectlink">
	                        #text($product)
	                    </a>
	                #end	
					#end
					</td>
					<td>$!context.getDate($rental.duedate) - $!context.getDate($rental.enddate)</td>
					<td>
						#set( $guest = $mediaarchive.getUser($rental.forcustomer) )
						$guest.getName() ($guest.getEmail())
					</td>
					<td>$rental.headcount</td>
					<td>$rental.paymentstatus</td>
					
					<td>
						<a href="$!{hitprojectlink}/store/reservations/previewinvoice.html?invoiceid=$rental.getId()" 
							class="emdialog btn btn-secondary btn-sm"
							data-hidefooter="true"><i class="fas fa-edit"></i> [[Edit]]</a>
						
					</td>
			</tr>
		#end
	    </tbody>
	</table>
</div>