#set($collectionid = $librarycol.getId())

<div id="subscriberssidebar" style="position:relative; ">

	#set($currentTotal = $transactionManager.getCombinedTotalIncome($librarycol.getId(),"1"))

##	#if( $caneditcollection)
	
##	<a class="emdialog btn btn-sm btn-light" style="position:absolute; right: 0px; top:20px;" data-allwaysloadpage="true" href="$applink/collective/edit/editcollective.html?collectionid=$librarycol.getId()" title="[[Edit your Goals]]"><i class="fas fa-cog"></i> [[Goals]]</a>
	
##	#end


##Distribution details, move all this to Donate/Expendetures area 

	<div class="sidebarbox" style="margin-top:0;"  >
		<h4><i class="fas fa-bullseye"></i> [[Goal]]
		</h4>
				<div class="" style="padding-left:6px;">		
				#if($librarycol.goaldate)
				<strong>[[Our Goal Is:]] $${librarycol.goalamount} by #date($librarycol,"goaldate")! </strong><br>
				#if($librarycol.distributedtotal) [[We have raised]]: $$!context.doubleToMoney($currentTotal, 2) USD<br> 
				Spent: $${librarycol.distributedtotal} <br>[[Remaining]]: $$mathutil.subtract($currentTotal,$librarycol.distributedtotal) #end
				#else
				<strong>[[No goals yet]]!</strong>
				#end
				</div>	

	</div>
	<div style="" class="text-center">
		<a href="$applink/collective/donate/$collectionid/donate.html" class="btn subscribe-btn">[[Donate]]</a>
	</div>
	
	#set( $donations = $mediaarchive.query("transaction").exact("collectionid",$collectionid).sort("paymentdateDown").search($context) )
	#set( $n = $donations.setHitsPerPage(6))
	<div class="sidebarbox" >
	
	<h4>
		<div class="float-right" style="font-size:0.9em; line-height: 1.4;">$$!context.doubleToMoney($currentTotal, 0)</div>
		<i class="fas fa-hand-holding-usd"></i> [[Donations]]
	</h4>	
			#if( !$donations.isEmpty() )
			<strong>[[Recent Donations]] ($donations.size())</strong>
				#foreach($transaction in $donations.getPageOfHits())
				 	#set( $selecteduser = $mediaarchive.getUser($transaction.userid) )
					<div style="background-color:#eee;padding:5px 10px 5px 10px; margin:4px 0;">
						<span style="font-size:1rem"><strong>$$transaction.totalprice</strong></span> [[from]]
						#if( $transaction.paymenttype =="paypal" && $transaction.name) 
							 $transaction.name
						#elseif($selecteduser)$!selecteduser.getAnonNickName()
						#end
						 <br>[[on]] $!context.getDateTime($transaction.paymentdate) 
					</div>	
				#end
			#end

			#set( $other = $mediaarchive.query("collectiveincome").exact("collectionid",$collectionid).sort("dateDown").search($context) )
			#if( !$other.isEmpty() )
				#set( $n = $other.setHitsPerPage(6))
			<strong>[[Other Income]] ($other.size())</strong>
				#foreach($transaction in $other.getPageOfHits())
				 	#set( $selecteduser = $mediaarchive.getUser($transaction.paidfrom) )
					<div style="background-color:#eee;padding:5px 10px 5px 10px; margin:4px 0;">
						<span style="font-size:1rem"><strong>$transaction.total</strong> $mediaarchive.getCachedData("currencytype", $transaction.currencytype)</span> 
						#if($selecteduser)[[from]] $!selecteduser.getAnonNickName()
						#else
						$transaction.incomedescription
						#end
						 <br>[[on]] $!context.getDateTime($transaction.date) 
					</div>	
				#end
			#end


	</div>

</div>
        
 