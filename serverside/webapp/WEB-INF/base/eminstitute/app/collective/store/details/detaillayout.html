<div id="storeworkarea" class="container" style="padding:10px 20px;min-height:500px">
<div id="storedetailarea" class="contentcolumn" >
	#set( $searchtype  = "collectiveproduct")

<div class="cardX" >
  <div class="card-bodyX">

  <div class="row">     
  	<div class="col-md-5" >
      <h5 class="card-title">	$!aproduct.getText("name",$context)</h5>
	    #if( $caneditcollection)
		<div >
		<a class="emdialog" title="[[Edit Product]]" 
			href="$apphome/collective/store/edit.html?id=$data.id&collectionid=$librarycol.id"><i class="fas fa-edit"></i></a>
		</div>
		#end

      	
		<div>      
	       <p class="">$!aproduct.getText("productdescription",$context)</p>
	       
			#set($subtotal = $aproduct.getDouble("productprice"))
			$!context.doubleToMoney($subtotal, 2) $!context.getText($!mediaarchive.getCachedData("currencytype", $aproduct.currencytype )) / $!context.getText($!mediaarchive.getCachedData("productrecurringperiod", $aproduct.recurringperiod ))
		</div>

		#set( $invoices = $mediaarchive.query("collectiveinvoice").exact("productlist.productid",$aproduct.id).sort("startdate").search($context))
  		#if( $invoices.isEmpty())
  			
  		#else
		
	  		<div style="max-width:200px">
			<ul>
			#foreach($invoice in $invoices)
				#if( $caneditsettings || $user.getId() == $invoice.forcustomer || $user.getId() == $invoice.owner)
				<li>
				<a class="emdialog"		
				 href="$apphome/collective/store/details/editinvoice.html?id=$invoice.id&productid=$data.id&collectionid=$librarycol.id" >
				$!context.getDate($invoice.getDate("duedate")) - $!context.getDate($invoice.getDate("enddate")) <br> $invoice.getName()
				</a>
				</li> 
				#else
				##$!context.getDate($invoice.getDate("duedate")) - $!context.getDate($invoice.getDate("enddate")) <br> $invoice.getName()
				#end
			#end
			</ul>
			</div>

		#end

#if( $user )

	#if($content.path.contains("/reserve/"))
		$pages.include("$apphome/collective/store/details/startinvoice.html",$context)	
	#else
      <div style="padding:20px;">
		      <a class="btn btn-primary"
		      href="$apphome/collective/store/details/reserve/$librarycol.id/$aproduct.id/startinvoice.html" >[[Make Reservation]]</a>
      </div>
    #end  
#else
	$pages.include("$apphome/components/xml/types/daterange.html",$context)
	<p id="loginarea"><a class="ajax" data-targetdiv="loginarea" data-oemaxlevel="1"
		 href="$applink/authentication/loginajax.html?loginokpage=$apphome/collective/store/details/reserve/$librarycol.id/$aproduct.id/startinvoice.html">login</a> to reserve</p>  
#end   	
	</div>
	<div class="col card-textX">
		#if( $data )
		#set( $assetshits = $mediaarchive.query("asset").exact("collectiveproduct",$data.id).search($context))
		#end
		$context.putPageValue("assetshits", $assetshits)
		$context.putPageValue("fullview",true) 
		$context.putPageValue("thumbsize", "small" )
		$context.putPageValue("primaryimage", $entity.primaryimage )
		#set( $assetsshown = 4)
		$pages.include("$apphome/collective/store/details/attachedmedia.html",$context)
      
		#set($uploadlink = "$siteroot$applink/views/modules/asset/add/start.html?entityupload=true&entitytype=$searchtype&entityvalue=$aproduct.id&collectionid=$librarycol.id")
		#set($oemaxlevel = "1")
		#set($targetdiv = "applicationmaincontent")
		<a href="$uploadlink" 
			class="ajax moreactions"
			data-targetdivinner="storedetailarea"
			data-closedialog="true" 
			data-closemediaviewer="true"
			data-updateurl="true"
			data-oemaxlevel="$!oemaxlevel"
			title="[[Upload assets here]]">
			<i class="fas fa-upload"></i></a>
    </div>

</div> <!--row -->

</div> <!-- body -->
</div> <!--  card -->


</div> <!-- storedetail -->
</div>