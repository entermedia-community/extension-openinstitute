#if(!$goalfolder)
	#set( $goalfolder = $context.getRequestParameter("goalfolder"))
	
	#if(!$goalfolder)
		#set( $goalfolder = $context.getPageValue("goalfolder") )
	#end
	
	#if(!$goalfolder)
		#set( $goalfolder = "search" )
	#end
#end
#set( $target = "$!{container}tasklist#eid($goal.id)")
#set( $onlyopen = $context.getRequestParameter("onlyopen"))
<div id="editgoal-${goal.id}">
<div id="$target" class="goaltaskcontainer">
<div>
		
	#set($caneditgoal = false)
	#if($user && ( $canviewsettings || $caneditcollection)  && $goal.collectionid)
		#set($caneditgoal = true)
	#end
	$context.putPageValue("caneditgoal", $caneditgoal)
	
	#set($points = 0)
	#foreach($task in $tasks)
		#set( $tree = $mediaarchive.getCachedData("projectdepartment",$task.projectdepartment) )
		#if($tree)
			#set( $c = $tree.getInt("goalpoints") )
			#if( $c == 0)
				#set( $c = 10)
			#end
			#set($points = $points + $c)
		#end
		#set($collectionid = $goal.collectionid)
		#set( $edittask = "$applink/collective/goals/task/taskedit.html?id=${task.id}&collectionid=$!collectionid&onlyopen=$!onlyopen&targetdiv=$target")
		
		
			<div id="$!{container}taskrow${task.id}" class="goaltaskrow #if($task.taskstatus == "0" && $task.completedby == $user.id)taskmyself#end">
			
				<div>$!tree</div>
				#set( $comment = $mediaarchive.query("goaltaskcomments").exact("goaltaskid",$task.id) )
				<div class="taskdetails">
					#if($!task.comment.length() > 300)
						$!task.comment.substring(0, 300) ...
					#else
						$!task.comment
					#end
				</div>
				#set( $type = "goaltask" )
				#set( $vals = $task.getValues("keywords") )
				#ifnotnull($vals)
				<div class="taskdetails">
					##USE AJAX
					#foreach( $val in $vals )
						#set($link = "$home$apphome/collective/goals/priorities/index.html?collectionid=$!collectionid&keyword=$val")
						<a	class="badge badge-tags tageditor-${type} tageditor-#esc($val)" href="$link" title="#esc($val)">#esc($val)</a> 
					#end
				</div>
				#end

				$context.putPageValue("task", $task)
				$pages.include("$apphome/collective/goals/task/rolelist.html", $context)

		
				<div class="taskstatus align-self-end"> 
					#if($task.taskstatus == "0")
					<div>
						<div class="badge text-bg-danger attn">
						<i class="fas fa-bullhorn me-1"></i> $!mediaarchive.getUser($task.completedby).getAnonNickName()
						</div>
					</div>
					#elseif($task.taskstatus == "1")
					<p class="text-warning m-0">
						<i class="fas fa-hourglass-half"></i> [[Pending]]
					</p>
					#elseif($task.taskstatus == "2")
					<p class="text-muted m-0">
						<i class="fas fa-ban"></i> [[Blocked]]
					</p>
					#elseif($task.taskstatus == "3")
					<p class="text-success m-0">
						<i class="fas fa-check"></i>[[Completed]]
					</p>
					#elseif($task.taskstatus == "4")
					<p class="text-secondary m-0">
						<i class="fas fa-sync"></i> [[Redo]]
					</p>
					#elseif($task.taskstatus == "5")
					<p class="text-info m-0">
						<i class="fas fa-sticky-note"></i> [[Note]]
					</p>
					#end  
					#if($caneditgoal)
						#if($task.taskstatus != "3")
							<div class="goalcloseout text-right">
							  	<form id="someform" class="ajaxform" data-targetdiv="$target" data-oemaxlevel="1" action="" >
							
								<a href="$applink/collective/goals/task/tasksave.html?goalid=$goal.id" 
									data-targetdiv="$target" 
									data-oemaxlevel="1"
									data-taskid="$task.id"
									data-taskstatus="3"
									class="ajax btn btn-sm btn-resolve btn-success">
									<i class="fas fa-check me-1"></i> [[Resolve]]
								</a>
							</div>
						#end	

					#end
					
					##set( $comment = $mediaarchive.query("goaltaskcomments").exact("goaltaskid",$task.id).match("commenttext","*").sort("dateDown").searchOne() )
				</div>
			</div>
			<div class="credit">
			
				<small>
					<a 
							id="task${task.id}"
							href="$edittask"
							title="[[Edit Task]]"
							href="#"
							title="[[Task]]"
							data-focuson="$task.id"
							data-width="900"
							class="taskedit-$!{task.taskstatus} ajax btn btn-sm mx-1 text-brand" 
							data-targetdiv="$!{container}taskrow${task.id}" 
							data-oemaxlevel="1" 
						>
					Added by <strong>$!mediaarchive.getUser($task.completedby).getAnonNickName()</strong> $task.getAge().replace(':', ' ') ago
				</a>
				</small>
			</div>
	#end

	<div class="clearfix"></div>	

	<div class="d-flex mt-2">
	<!-- 
	#if($user && $caneditgoal)
		<a class="appendgoalbutton btn btn-sm btn-outline-brand me-1"
			title="[[Add Task]]"
			data-targetdiv="$target"
			data-cancelsubmit="true"
			data-parameterdata="categoryvalues"
			data-collectionid="$goal.collectionid"
			data-categoryid="$!selectedcat.getId()"
			data-hitssessionid="$!{goalhits.getSessionId()}"
			data-goalfolder="$!goalfolder" ##tabs
			data-pickone="true"
			data-goalid="$goal.id"
			data-dialogid="picktask"
			href="$applink/collective/goals/task/taskedit.html"
		>
			<i class="fas fa-clipboard-check"></i> [[Add Action]]
		</a>
	#end
	#if (!$onlyopen && $points>0)
		$points
	#end
 -->
	</div>
	
</div>		
</div>	

</div>


