#set($collectionid = $context.getRequestParameter("collectionid"))

<div class="container">
	<div class="row">
		<div class="col" >
		<div  style="width:100%;">
		    <h1>[[Profit and Loss]]</h1>
			<h3>Net Income</h3>
			
			#set( $totals = $financeManager.getTotalIncomesByDateRange($collectionid, $daterange) )
			<ul>
			#foreach( $total in $totals)
				$total
				<li>$total.getCurrency() :  $financeManager.getTotalExpenseByCurrency($collectionid, $total.getCurrency(), $daterange) - $total.getAmount() 
						=  $financeManager.getNetIncomeByCurrency($collectionid, $total.getCurrency(),$daterange)
				</li>
			#end
			</ul>
				<h3>Income</h3> 
				##<a href="#" class="btn btn-sm btn-secondary">[[Add New Income]]</a>
			
			#set( $incomebytype = $financeManager.getIncomeTypesByDateRange($collectionid, $daterange) )
			<ul>
			#foreach( $bytype in $incomebytype)
				<li>$bytype.getCurrency() -> $bytype.getExpenseType() $bytype.getTotal()</li>
			#end
			</ul>
			<h3>Expense</h3>  
							## <a href="#"  class="btn btn-sm btn-secondary">[[Add New Expense]]</a>
			#set( $expensebytype = $financeManager.getExpenseTypesByDateRange($collectionid, $daterange) )
			
			
			<table class="table" >
			#set($currency = "0")
			#foreach( $type in $expensebytype.keySet())
				#set($current = $expensebytype.get($type))
				#foreach($row as $current)
					#if($row.currencytype != $currency)
						#set($currency = $row.currencytype)
						<tr>
						<td style="width:10%">$mediaarchive.getData("currencytype", $row.currencytype)</td>
						<td></td>
						<td></td>
						<td></td>
						</tr>
					#end 
					<tr>
					<td style="width:10%"></td>
					<td>$mediaarchive.getData("expensetype", $row.expensetype)</td>
					<td style="width:10%; text-align: right;">$ $!context.roundDouble($row.getValue("total"),2)</td>
					<td style="width:10%"></td>
					</tr>
					
				#end
			#end
			</table>
		</div>
		</div>
	</div>
</div>
			
			
			