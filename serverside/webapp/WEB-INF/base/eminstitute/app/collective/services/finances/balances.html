#set( $topic = $context.getRequestParameter("collectiveproject"))		
#set($collectionid = $context.getRequestParameter("collectionid"))


			<h3>[[Incomes]]</h3> 
			##<a href="#" class="btn btn-sm btn-secondary">[[Add New Income]]</a>
		
			#set( $incomebytype = $financeManager.getIncomeTypesByDateRange($collectionid, $daterange, $topic) )
		
			<table class="table tablefinances" >
			#set($thecurrency = "0")
			#set($totalbycurrency = 0)
			
			#foreach( $currencytype in $incomebytype.keySet())
				#set($current = $incomebytype.get($currencytype))
	
				#foreach($type as $current)
					#if($type.currencytype != $thecurrency)
						#set($thecurrency = $type.currencytype)
						<tr class="tablefinances-header">
						<td style="width:10%">$!context.getText($!mediaarchive.getCachedData("currencytype", $type.currencytype))</td>
						
						<td></td>
						
						</tr>
					#end 
					<tr class="tablefinances-header">
						
						<td>
						#if($type.incometype)
							$!context.getText($mediaarchive.getCachedData("incometype", $type.incometype))
						#else
							##OI Donation
							[[Donation or Invoice]]
						#end
						</td>
						<td class="table-col-totals">$!context.doubleToMoney($type.getValue("total"),2)</td>
						
					</tr>
					#set($totalbycurrency = $totalbycurrency + $type.getValue("total"))
					
				#end
					<tr>
					<td></td>
					<td style="text-align: right;">[[Total]]:</td>
					<td class="table-col-totals">$!context.doubleToMoney($totalbycurrency,2)</td>
					
					</tr>
					#set($totalbycurrency = 0)
				
			#end
			</table>

			
			<h3>[[Normal Expenses]]</h3>  
			#set($toalusd = 0.0)
							## <a href="#"  class="btn btn-sm btn-secondary">[[Add New Expense]]</a>
			#set( $currencymap = $financeManager.getNormalExpenseTypesByDateRange($collectionid, $daterange,$topic) )
			
			<table class="table tablefinances" >
			#set($totalbycurrency = 0)
			#foreach( $currencytype in $currencymap.keySet())
				<tr class="tablefinances-header">
				#set( $currency = $mediaarchive.getCachedData("currencytype", $currencytype))
				<td colspan="2" >#text( $currency )</td>
				</tr>
			
				#set( $inExpensess = $currencymap.get($currencytype))
				#set( $expensetotals = $financeManager.sumarizeByExpenseType($inExpensess) )
				#foreach($expensecategory as $expensetotals)
					<tr class="">
						
						<td>$!context.getText($expensecategory.expensetype)</td>
						<td class="table-col-totals">- $!context.doubleToMoney($expensecategory.getValue("total"),2)</td>
					</tr>
					#set($totalbycurrency = $totalbycurrency + $expensecategory.getValue("total"))
				#end
				<tr>
				<td style="text-align: right;"><strong>[[Sub Total]]:</strong></td>
				<td class="table-col-totals">
				#if( $currency.exchangetousd != "1")
					#set( $convert = $currency.getValue("exchangetousd"))
					#set($usd = $totalbycurrency/$convert)
					[ -$${context.doubleToMoney($usd,2)} ]
				#else
					#set( $usd = $totalbycurrency)
				#end
				#set( $toalusd = $toalusd + $usd)
				
				<strong>- $!context.doubleToMoney($totalbycurrency,2)</strong>
				</td>
				
				</tr>
				#set($totalbycurrency = 0)
				
			#end
			
							<tr>
				<td style="text-align: right;"><strong>[[Total]]:</strong></td>
				<td class="table-col-totals">
				<strong>USD -$$!context.doubleToMoney($toalusd,2)</strong>
				</td>
				
				</tr>
			
			
			</table>
			<h3>[[Capital Expenses]]</h3>  
			#set( $currencymap = $financeManager.getCapitalExpenseTypesByDateRange($collectionid, $daterange,$topic) )
			
			<table class="table tablefinances" >
			#set($totalbycurrency = 0)
			#foreach( $currencytype in $currencymap.keySet())
				<tr class="tablefinances-header">
				<td colspan="2" >$!context.getText($!mediaarchive.getCachedData("currencytype", $currencytype))</td>
				</tr>
			
				#set( $inExpensess = $currencymap.get($currencytype))
				#set( $expensetotals = $financeManager.sumarizeByExpenseType($inExpensess) )
				#foreach($expensecategory as $expensetotals)
					<tr class="">
						
						<td>$!context.getText($expensecategory.expensetype)</td>
						<td class="table-col-totals">- $!context.doubleToMoney($expensecategory.getValue("total"),2)</td>
					</tr>
					#set($totalbycurrency = $totalbycurrency + $expensecategory.getValue("total"))
				#end
				<tr>
				<td style="text-align: right;"><strong>[[Total]]:</strong></td>
				<td class="table-col-totals"><strong>- $!context.doubleToMoney($totalbycurrency,2)</strong></td>
				
				</tr>
				#set($totalbycurrency = 0)
				
			#end
			</table>
			
