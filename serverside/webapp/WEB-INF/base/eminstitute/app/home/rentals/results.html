<div class="container search">
  <form class="d-flex flex-column align-items-center">
    <div class="d-flex align-items-center justify-content-center flex-wrap mt-4 w-100 gap-2">
      <div class="form-floating flex-grow-1">
        <input class="form-control" id="location" placeholder="Where to?" name="location" />
        <label for="location">Destination</label>
      </div>
      <div class="d-flex align-items-center justify-content-center flex-wrap gap-2">
        <div class="form-floating flex-grow-1">
          <input type="date" class="form-control" id="checkIn" placeholder="Check-In" name="in" />
          <label for="dateRange">Check-In</label>
        </div>
        <div class="form-floating flex-grow-1">
          <input type="date" class="form-control" id="checkOut" placeholder="Check-Out" name="out" />
          <label for="dateRange">Check-Out</label>
        </div>
        <div class="form-floating flex-grow-1">
          <input type="number" class="form-control" id="checkOut" placeholder="Guests" name="guests" readonly />
          <label for="dateRange">Guests</label>
        </div>
      </div>
      <button class="search-btn">Search</button>
    </div>
  </form>
</div>

##$pages.include("$apphome/home/rentals/daterange.html", $context)

#set( $hits =
$mediaarchive.query("collectiveproduct").hitsPerPage(20).orgroup("collectionid",$projects).exact("producttype","5").sort("name").search($context))
<div class="main container-fluid text-center">
  <div class="d-flex justify-content-center flex-wrap">
    #foreach( $aproduct in $hits.getPageOfHits())
      #set($logo = false)
      #if($collective.assetportrait)
        #set($asset = $mediaarchive.getAsset($collective.assetportrait))
        #set($logo = $mediaarchive.asLinkToPreview($asset,"image200x200.png"))
      #else
        #set($logo = "$applink/theme/images/OI_flower.png")
      #end
      #if(!$link)
        #set($link = "$applink/collective/channel/${collective.id}/#dash($collective.getName()).html")
      #end

      #set( $collectives =
      $mediaarchive.query("librarycollection").match("library","organizations").sort("name").search())
      #set( $hit = false)
      <div class="ad-container" id="ad"
        data-href="$sitelink/app/collective/store/details/$collectionid/$aproduct.id/#esc($aproduct.name).html"
        title="#text($aproduct.name)">
        <div class="ad-body">
          $context.putPageValue("aproduct",$aproduct)
          #set( $hit = $mediaarchive.getAsset( $aproduct.primaryimage) )
          #set($subtotal = $aproduct.getDouble("productprice"))
          <div class="ad-img">
            <div id="imgCarousel" class="carousel slide">
              <div class="carousel-indicators">
                <button type="button" data-bs-target="#imgCarousel" data-bs-slide-to="0" class="active"></button>
                <button type="button" data-bs-target="#imgCarousel" data-bs-slide-to="1"></button>
                <button type="button" data-bs-target="#imgCarousel" data-bs-slide-to="2"></button>
              </div>
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="https://source.unsplash.com/collection/8890044/600x480" />
                </div>
                <div class="carousel-item">
                  <img src="https://source.unsplash.com/collection/8890044/600x480" />
                </div>
                <div class="carousel-item">
                  <img src="https://source.unsplash.com/collection/8890044/600x480" />
                </div>
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#imgCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon"></span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#imgCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" role="button"></span>
              </button>
            </div>
            #set( $userimageurl = "$applink/theme/images/product-image.png" )
            <button class="owner-btn" data-name="John Doe" data-reviews="144" data-rating="4.56" data-rank="Host"
              data-duration="5" data-location="San Lucas Sacatepéquez"
              data-description="Lore ipsum dolor sit amet, adipiscing elit.">
              <img src="$userimageurl" />
            </button>
          </div>
          <div class="ad-details">
            <p class="rating">★ 4.56</p>
            <p class="location text-truncate" style="max-width: calc(100% - 50px)">
              $!aproduct.getText("name",$context)
            </p>
            <p class="owner text-truncate">Hosted by $!aproduct.getText("name",$context)</p>
            <div class="d-flex justify-content-between mt-2">
              <p class="availability">Sep 10 &mdash; Sep 25</p>
              <p class="price">
                <span class="currency">$!context.getText($!mediaarchive.getCachedData("currencytype",
                  $aproduct.currencytype )) $!context.doubleToMoney($subtotal, 2)</span>/<span
                  style="text-transform: lowercase;">[[Night]]</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    #end
  </div>
</div>
<div class="modal fade" id="ownerPreview">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content owner-preview">
      <button type="button" class="btn-close"></button>
      <div class="details-card">
        <img src="https://loremflickr.com/g/320/240/potrait,people/all" />
        <p class="name"></p>
        <p class="rank"></p>
        <div class="d-flex justify-content-around w-100 stats">
          <p class="reviews">
            <strong></strong>
            <small>Reviews</small>
          </p>
          <p class="rating">
            <strong></strong>
            <small>Rating</small>
          </p>
          <p class="duration">
            <strong></strong>
            <small>Years hosting</small>
          </p>
        </div>
      </div>
      <p class="description"></p>
    </div>
  </div>
</div>
<script>
  $(document).ready(function () {
    $(".offcanvas-body").html($(".navbar-nav").html());
    $("#checkIn").attr("min", new Date().toISOString().split("T")[0]);
    $("#checkIn").on("change", function () {
      var checkOutDate = new Date($(this).val());
      checkOutDate.setDate(checkOutDate.getDate() + 1);
      $("#checkOut").attr("min", $(this).val());
      $("#checkOut").val(checkOutDate.toISOString().split("T")[0]);
    });
    $(".owner-btn").click(function (e) {
      e.stopPropagation();
      var reviews = $(this).data("reviews");
      var rating = $(this).data("rating");
      var rank = $(this).data("rank");
      var duration = $(this).data("duration");
      var location = $(this).data("location");
      var description = $(this).data("description");
      var name = $(this).data("name");
      var img = $(this).find("img").attr("src");

      var modelEl = $("#ownerPreview");
      modelEl.find(".reviews strong").text(reviews);
      modelEl.find(".rating strong").text(rating);
      modelEl.find(".duration strong").text(duration);
      modelEl.find(".location").text(location);
      modelEl.find(".description").text(description);
      modelEl.find(".name").text(name);
      modelEl.find(".rank").text(rank);
      modelEl.find("img").attr("src", img);

      var modal = new bootstrap.Modal(modelEl);
      modal.show();
    });
    $(".btn-close").click(function () {
      var modal = bootstrap.Modal.getInstance(
        document.querySelector("#ownerPreview")
      );
      modal.hide();
    });
    $(document).on("click", "#ad", function (e) {
      if (e.target.nodeName === "SPAN" || e.target.nodeName === "BUTTON") {
        return;
      }
      window.location.href = $(this).data("href");
    });
  });
</script>